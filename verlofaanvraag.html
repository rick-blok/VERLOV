<!DOCTYPE html>
<html>
<head>
<script type="text/javascript">
<!--
var params = "";
var p = [];
p['begin_datum']="25-10-2019";
p['begin_tijd']="08:30";
p['eind_datum']="25-10-2019";
p['eind_tijd']="17:12";
p['aantal_uur']="";
p['toelichting']="";
p['person_id']=0;
p['empno']=0;
p['verlof_type']="V";
p['parafeerder']=0;
p['user_id']=0;
p['nids']=0;
p['to_url']=0;
p['locatie']=0;
p['saldo_verlof']=0;
p['saldo_atv']=0;
p['stnd_uren']=0;
p['pagina']=0;

var aanvragenverstuurd=0;

// Get user specific variables
var http = new XMLHttpRequest();
var urlget = "http://verlof/";
http.open('GET', urlget, true);
http.onreadystatechange = function() {//Call a function when the state changes.
    if(http.readyState == 4 && http.status == 200) {
        document.getElementById('response').innerHTML = http.responseText;
		
		//setTimeout(function(){
			// get variables for post
			p['pagina'] 	= document.querySelector("#response input[name='pagina']").value;
			p['person_id'] 	= document.querySelector("#response input[name='person_id']").value;
			p['empno'] 		= document.querySelector("#response input[name='empno']").value;
			p['parafeerder']= document.getElementById("parafeerder").value;
			p['user_id']	= document.querySelector("#response input[name='user_id']").value;
			p['nids']		= document.querySelector("#response input[name='nids']").value;
			p['to_url']		= document.querySelector("#response input[name='to_url']").value;
			p['locatie']	= document.querySelector("#response input[name='locatie']").value;
			p['saldo_verlof']=document.querySelector("#response input[name='saldo_verlof']").value;
			p['saldo_atv']	= document.querySelector("#response input[name='saldo_atv']").value;
			p['stnd_uren']	= document.querySelector("#response input[name='stnd_uren']").value;
			
			/*for (var key in p){
				params += encodeURIComponent( key + "=" + p[key] + "&" );
			}
			params = params.substring(0, params.length - 1);
			document.getElementById('input').innerHTML = params;*/
		//}, 1);
		
	}
}
http.send();

aanvragenverstuurd=0;
function stuurAanvraag(){
	var url = 'http://verlof/v1.1/VerlofSubmit.php';
	params = "";
	for (var key in p){
		//params += encodeURIComponent( key + "=" + p[key] + "&" );
		params +=  key + "=" + p[key] + "&" ;
	}
	params = params.substring(0, params.length - 1);
	http.open('POST', url, true);
	http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	http.send(params);
}

var verloflijst="";
var verloven = [];
function checkInputCalendar(){
	verloven = [];
	var e = document.getElementById("verlof").getElementsByTagName('input');
	for (var i = 0; i < e.length; i++){ 
		// sanitize
		if (!e[i].value.match(/^[1-8]{1}$/)){
			e[i].value = "";
			continue;
		}

		
		var j = verloven.length;
		verloven[j] = [];
		if (e[i].value % 4 == 0){
			//dag
			if ( (j > 0 && verloven[j-1]["type"] == "verlof dag" && verloven[j-1]["eindt"] == "17:12" ) ){
				// ga verder met de vorige
				verloven[j-1]["eind"] = e[i].name;
				verloven[j-1]["eindt"] = e[i].value == 4 ? "12:30" : "17:12";
				verloven[j-1]["aantal"] += e[i].value;
				verloven.pop();
			} else {
				// nieuwe aanvraag
				verloven[j]["start"] = e[i].name;
				verloven[j]["startt"] = e[i].value == 4 ? "13:12" : "8:30";
				verloven[j]["eind"] = e[i].name;
				verloven[j]["eindt"] = "17:12";
				verloven[j]["type"] = "verlof dag";
				verloven[j]["aantal"] = e[i].value;
			}
		} else{
			//uren
			verloven[j]["start"] = e[i].name;
			verloven[j]["eind"] = e[i].name;
			verloven[j]["type"] = "verlof uur";
			verloven[j]["aantal"] = e[i].value;
		}
	}
	
	console.debug(verloven);
}

//-->
</script>
<style type="text/css">
<!--
#input{
	height: 15em;
	background-color: #DDD;
	top:0;
	left:0;
	right:0;
	position:absolute;
}
#response{
   overflow-x:auto;
   top:15em;  /* as the height of the other div is 30px */
   left:0;
   right:0;
   bottom:0;
   position:absolute;
}
#calendar{
	display: table-row;
}
#left {
	float:left;
	display: table-cell;
	width: 2em;
}
#right{
	float: right;
	display: table-cell;
	width: 2em;
}
#wrapper {
	display: table-cell;
	left:6em;
	right:2em;
	background-color:red;
	overflow-x: auto;
	width: 100%;
}
#verlof, #ATV{
	display: table-row;
	left:6em;
	right:2em;
	background-color:red;
	overflow-x: auto;
}
#header .week span{
	width: 2.1em;
	display: table-cell;
	text-align: center;
}
.week{
	width: 15em;
	display: table-cell;
	background-color:#FFF;
}
.week input{
	width:2em;
	padding: 0;
	margin: 0;
}
#labels{
	display: table-cell;
	left:2em;
	width: 4em;
}
.label{
	display: table-row;
	width: 4em;
}
//-->
</style>
<body>

<div id="input">
	<div id="calendar">
		<div id="left">
			<a href="#" onclick="javascript:addWeekBefore()">-</a>
		</div>
		<div id="labels">
			<div class="label">&nbsp;</div>
			<div class="label">Velof</div>
			<div class="label">ATV</div>
		</div>
		<div id="wrapper">
			<div id="header">
				
				<div class="week">
					<span>15-6</span>
					<span>16-6</span>
					<span>17-6</span>
					<span>18-6</span>
					<span>19-6</span>
					<span>20-6</span>
					<span>21-6</span>
				</div>
				<div class="week">
					<span>22-6</span>
					<span>23-6</span>
					<span>24-6</span>
					<span>25-6</span>
					<span>26-6</span>
					<span>27-6</span>
					<span>28-6</span>
				</div>
				<div class="week">
					<span>29-6</span>
					<span>30-6</span>
					<span>1-7</span>
					<span>2-7</span>
					<span>3-7</span>
					<span>4-7</span>
					<span>5-7</span>
				</div>
			</div>
			<div id="verlof">
				<div class="week">
					<input type="text" name="15-6-19">
					<input type="text" name="16-6-19">
					<input type="text" name="17-6-19">
					<input type="text" name="18-6-19">
					<input type="text" name="19-6-19">
				</div>
				<div class="week">
					<input type="text" name="22-6-19">
					<input type="text" name="23-6-19">
					<input type="text" name="24-6-19">
					<input type="text" name="25-6-19">
					<input type="text" name="26-6-19">
				</div>
				<div class="week">
					<input type="text" name="29-6-19">
					<input type="text" name="30-6-19">
					<input type="text" name="1-7-19">
					<input type="text" name="2-7-19">
					<input type="text" name="3-7-19">
				</div>
			</div>
			<div id="ATV">
				<div class="week">
					<input type="text">
					<input type="text">
					<input type="text">
					<input type="text">
					<input type="text">
				</div>
				<div class="week">
					<input type="text">
					<input type="text">
					<input type="text">
					<input type="text">
					<input type="text">
				</div>
				<div class="week">
					<input type="text">
					<input type="text">
					<input type="text">
					<input type="text">
					<input type="text">
				</div>
			</div>
		</div>
		<div id="right">
			<a href="#" onclick="javascript:addWeekAfter()">+</a>
		</div>
	</div>

	<a href="#" onclick="javascript:checkInputCalendar();">Check Input</a><br>
	<a href="#" onclick="javascript:stuurAanvraag();">doe aanvraag</a>
</div>
<div id="response">leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br>leeg<br></div>

</body>
</html>
